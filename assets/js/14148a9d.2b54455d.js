"use strict";(self.webpackChunkdocs_new=self.webpackChunkdocs_new||[]).push([[573],{7557:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"architecture/p2p-protocol","title":"Peer-to-Peer Protocol","description":"The communication layer for secure device-to-device networking \u2013 anywhere","source":"@site/docs/architecture/p2p-protocol.mdx","sourceDirName":"architecture","slug":"/architecture/p2p-protocol","permalink":"/architecture/p2p-protocol","draft":false,"unlisted":false,"editUrl":"https://github.com/drasyl/docs.drasyl.org/blob/master/docs/architecture/p2p-protocol.mdx","tags":[],"version":"current","lastUpdatedAt":1753956870000,"frontMatter":{"title":"Peer-to-Peer Protocol","description":"The communication layer for secure device-to-device networking \u2013 anywhere"},"sidebar":"tutorialSidebar","previous":{"title":"How drasyl Works","permalink":"/architecture"},"next":{"title":"Network Management","permalink":"/architecture/network-management"}}');var r=n(4848),o=n(8453);const a={title:"Peer-to-Peer Protocol",description:"The communication layer for secure device-to-device networking \u2013 anywhere"},s="The Peer-to-Peer Protocol",c={},l=[{value:"Why a custom NAT traversal protocol?",id:"why-a-custom-nat-traversal-protocol",level:2},{value:"How a connection is established",id:"how-a-connection-is-established",level:2}];function h(e){const t={a:"a",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"the-peer-to-peer-protocol",children:"The Peer-to-Peer Protocol"})}),"\n",(0,r.jsxs)(t.p,{children:["At the core of drasyl lies a ",(0,r.jsx)(t.strong,{children:"custom-designed, lightweight peer-to-peer protocol"})," built to establish direct and secure connections between devices with minimal latency. Unlike conventional ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/NAT_traversal",children:"NAT traversal"})," frameworks, it was developed from scratch to tightly integrate NAT traversal, cryptographic handshakes, and fallback mechanisms into a unified process."]}),"\n",(0,r.jsxs)(t.p,{children:["The protocol combines multiple NAT traversal techniques, including hole punching and relay fallback, with a compact, latency-optimized cryptographic handshake. All communication is secured using ",(0,r.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/draft-irtf-cfrg-aegis-aead/",children:"AEGIS"}),", a high-performance authenticated encryption algorithm that ensures strong confidentiality and integrity, even on devices without hardware acceleration."]}),"\n",(0,r.jsx)(t.p,{children:"Each peer is uniquely identified by a public key, which enables location-independent communication across NATs, firewalls, and heterogeneous networks. Since peer identities and key material are known in advance, the cryptographic handshake can be accelerated."}),"\n",(0,r.jsxs)(t.p,{children:["This communication layer forms the foundation of drasyl\u2019s dynamic overlay networks. It enables any two devices to connect using the best available physical path, securely, efficiently, and without manual configuration. The protocol is implemented independently from our SDN solution and is available as open-source software (FOSS), licensed under the ",(0,r.jsx)(t.a,{href:"https://github.com/drasyl/drasyl-rs/blob/master/LICENSE",children:"MIT License"})," on GitHub: ",(0,r.jsx)(t.a,{href:"https://github.com/drasyl-rs/drasyl-p2p",children:"https://github.com/drasyl-rs/drasyl-p2p"})]}),"\n",(0,r.jsx)(t.h2,{id:"why-a-custom-nat-traversal-protocol",children:"Why a custom NAT traversal protocol?"}),"\n",(0,r.jsxs)(t.p,{children:["To understand why we chose to develop a custom protocol, it is helpful to compare it with standardized NAT traversal approaches such as ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Interactive_Connectivity_Establishment",children:"Interactive Connectivity Establishment (ICE)"}),", as used in ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/WebRTC",children:"WebRTC"}),", provide a robust foundation for establishing direct connections between peers. ICE coordinates the use of the ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/STUN",children:"STUN"})," and ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Traversal_Using_Relays_around_NAT",children:"TURN"})," protocols to discover connection candidates and traverse NATs, while relying on a separate signaling channel for coordination (which itself requires an ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Session_Initiation_Protocol",children:"additional protocol"}),")."]}),"\n",(0,r.jsxs)(t.p,{children:["Each of these protocols serves a specific purpose and works reliably within its scope. However, achieving a high success rate for direct connections typically requires their combined use, along with additional protocols such as ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Datagram_Transport_Layer_Security",children:"DTLS"})," or ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Transport_Layer_Security",children:"TLS"})," for securing the connection. This layered setup leads to multiple handshakes and round trips, resulting in increased connection establishment delays."]}),"\n",(0,r.jsxs)(t.p,{children:["Motivated by the goal of minimizing secure connection establishment times, we developed a custom NAT traversal protocol that integrates the necessary mechanisms into a single, streamlined process. Similar to the approach taken by the creators of ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/QUIC",children:"QUIC"}),", we aimed to reduce round trips, unify handshakes, and enable secure communication as early as possible."]}),"\n",(0,r.jsxs)(t.p,{children:["Our protocol minimizes the number of sequential handshakes and merges multiple steps into a single, compact interaction. In typical cases, a secure direct tunnel can be established in ",(0,r.jsx)(t.strong,{children:"1\u20132 RTTs"}),". In parallel, a ",(0,r.jsx)(t.strong,{children:"relayed tunnel"})," is immediately available, enabling ",(0,r.jsx)(t.strong,{children:"0-RTT secure communication"}),".\nOur SDN solution benefits directly from these improvements, enabling faster network setup and reconnection after disruptions or physical network changes."]}),"\n",(0,r.jsxs)(t.p,{children:["We presented the details of these design principles in a ",(0,r.jsx)(t.a,{href:"https://ieeexplore.ieee.org/abstract/document/10279326",children:"research paper"}),", where we demonstrated how the cryptographic handshake of TLS can be piggybacked onto the hole punching process to minimize connection establishment time and enhance the overall security of NAT traversal."]}),"\n",(0,r.jsx)(t.h2,{id:"how-a-connection-is-established",children:"How a connection is established"}),"\n",(0,r.jsxs)("figure",{style:{textAlign:"center"},children:[(0,r.jsx)("img",{src:"/img/drasyl-p2p.svg",alt:"Node peers and super peer interaction",style:{maxWidth:"700px",width:"100%",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.15)",margin:"1rem auto"}}),(0,r.jsx)("figcaption",{style:{textAlign:"center",color:"#666"},children:(0,r.jsx)(t.p,{children:"Figure 1: Node peers and super peer interaction"})})]}),"\n",(0,r.jsxs)(t.p,{children:["Devices that want to establish a connection with each other are referred to as ",(0,r.jsx)(t.strong,{children:"node peers"}),". To enable peer discovery and connection establishment, all node peers continuously publish their own connection information (1) to a well-known reachable ",(0,r.jsx)(t.strong,{children:"super peer"}),". This information includes possible IP endpoints through which a peer believes it can be reached. While the figure shows only a single super peer, drasyl in practice operates a globally distributed network of super peers to ensure high scalability, availability, and load balancing of this service."]}),"\n",(0,r.jsx)(t.p,{children:"When a node peer A wants to connect to node peer B, it sends a connection request (2) to the super peer that appears closest from its perspective. This request can also be implicit: if a node peer immediately starts using the super peer as a relay, the relay detects that no direct communication exists yet and automatically distributes the connection information (3) to both peers.\nIn either case, the super peer provides each node peer with the connection information of the other, including both the published IP endpoints and additional IP endpoints the super peer has observed."}),"\n",(0,r.jsxs)(t.p,{children:["Based on this information, both node peers attempt to reach each other directly (4) to establish a path for ",(0,r.jsx)(t.em,{children:"direct communication"}),". Even if no direct path is currently available, ",(0,r.jsx)(t.em,{children:"relayed communication"})," can proceed through the closest super peer.\nBoth peers agree on a shared secret key either during the reachability checks or when using the super peer as a relay. If a direct connection cannot be established immediately, the system continuously retries and never gives up. Once a direct path has been established, the node peers can maintain it independently without any further involvement of a super peer. If a direct path becomes inactive, it is torn down and reestablished only when needed."]})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>s});var i=n(6540);const r={},o=i.createContext(r);function a(e){const t=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);